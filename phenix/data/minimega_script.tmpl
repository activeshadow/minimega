namespace {{ .ExperimentName }}
ns queueing true

# How do we track `runlocal`
{{ if runlocal }}
ns del-host all
ns add-host localhost
{{ end }}

{{ range .Nodes }}

{{ $vm_name := {{ .ExperimentName }}_{{ .General.Hostname }} }}
# guessing on net.LookupHost
{{ $hostname := net.LookupHost(hostname) }}
{{ $snapshot_name := {{ $hostname }}_{{ .ExperimentName }}_{{ .General.Hostname }}_snapshot }}
{{ $vm_type := COMPLETE_ME }}

# need to deal with vm_disk and vm_disk_image and vm_disk_rest
# maybe reference to example
# vm config disk linux_disk.qcow2,ide storage_disk.qcow2

{{ if .General.Snapshot }}
disk snapshot {{ .Drive.Image }} {{ $snapshot_name }} 
disk inject {{ $snapshot_name }}:{{ .Drive.InjectPartition }} files {{ .Injection.Src }}:{{ .Injection.Dst }}
{{ end }}
clear vm config
{{ if .Schedule.Hostname }}
vm config schedule {{ .Schedule.ClusterNode }}
{{ end }}
vm config vcpus {{ .Hardware.VCPU }}
vm config cpu {{ .Hardware.CPU }}
vm config memory {{ .Hardware.Memory }}
vm config snapshot {{ .General.Snapshot }}
{{ if .General.Snapshot }}
# need to complete VM_DISK_REST
vm config disk {{ $snapshot_name }} VM_DISK_REST
{{ else }}
# not sure what the split() in vm_disk is for
vm config disk {{ .Drive.Image }} VM_DISK_REST
{{ end }}
# does linux need ""
{{ if .Hardware.OSType eq "linux" }}
vm config qemu-append -vga qxl
{{ end }}
vm config net {{ .VLAN.Name }}
vm launch {{ $vm_type }} {{ $vm_name }}

{{ end }}